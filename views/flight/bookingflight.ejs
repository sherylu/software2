<%- include ../partials/banner.ejs %>

<%- include ../partials/error.ejs %>

<div class="container">
    <div class="col-md-8">

        <div class="row">
            <div class="col-md-8">
                <%- include ../partials/error.ejs %>
            </div>
        </div>

            <%- include partials/client.ejs %>
            
            <% for (var i=1; i<seats; i++) { %>
                <%- include partials/passenger.ejs %>
            <% } %> 

        </div>
    </div>

    <script>
        $(document).ready(function () {
           
            
            var retrieveClient = function() {
                var client = {};
                client.firstName = $('#firstName').val();
                client.lastName = $('#lastName').val();
                client.passportId = $('#identification').val();
                client.phoneNumber = $('#phone').val();
                client.email = $('#email').val();
                client.age = $('#age').val();
                client.handicap = $('#handicapped').prop('checked')? $('#handicap').val() : 0;
                return client;
            }
            
            var retrievePassengers = function(n) {
                var passengers = [];
                for (var i=1; i<seats; i++) {
                    var passenger = {};
                    passenger.firstName = $('#firstName'+i).val();
                    passenger.lastName = $('#lastName'+i).val();
                    passenger.passportId = $('#identification'+i).val();
                    passenger.phoneNumber ="";
                    passenger.email = "";
                    passenger.age = $('#age'+i).val();
                    passenger.handicap = $('#handicapped'+i).prop('checked')? $('#handicap'+i).val() : 0
                    passengers.push(passenger);
                }
                return passengers;
            }

            $('#btn-booking').click(function () {


                if ($('#email').val().match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)) {
                   var clients = [];
                
                    clients.push(retrieveClient());
                    
                    passengers = retrievePassengers(<%=seats%>);
                    clients = clients.concat(passengers);
                    
                    
    
                    $.post("/flight/sendbookingmail", {
                        obj: clients,
                        reservation: [flightCodeLeaving, flightCodeReturning]
                    }); 
                } else {
                    alert('El email insertado no es valido');
                    $('#email').focus();
                }
                
                

            });
        });
    </script>
